#include "tempdir.bash"

cat >test.in <<EOF
Adder4::io_Cin = in/1
Adder4:Adder0::io_cin = mov Adder4::io_Cin
Adder4::io_B = in/4
T0 = rsh/1 Adder4::io_B 0'1
Adder4:Adder0::io_b = mov T0
Adder4::io_A = in/4
T1 = rsh/1 Adder4::io_A 0'1
Adder4:Adder0::io_a = mov T1
Adder4:Adder0::a_xor_b = xor Adder4:Adder0::io_a Adder4:Adder0::io_b
T2 = xor Adder4:Adder0::a_xor_b Adder4:Adder0::io_cin
Adder4:Adder0::io_sum = mov T2
Adder4:Adder0::a_and_cin = and Adder4:Adder0::io_a Adder4:Adder0::io_cin
Adder4:Adder0::b_and_cin = and Adder4:Adder0::io_b Adder4:Adder0::io_cin
Adder4:Adder0::a_and_b = and Adder4:Adder0::io_a Adder4:Adder0::io_b
T3 = or Adder4:Adder0::a_and_b Adder4:Adder0::b_and_cin
T4 = or T3 Adder4:Adder0::a_and_cin
Adder4:Adder0::io_cout = mov T4
Adder4:Adder1::io_cin = mov Adder4:Adder0::io_cout
T5 = rsh/1 Adder4::io_B 1'1
Adder4:Adder1::io_b = mov T5
T6 = rsh/1 Adder4::io_A 1'1
Adder4:Adder1::io_a = mov T6
Adder4:Adder1::a_xor_b = xor Adder4:Adder1::io_a Adder4:Adder1::io_b
T7 = xor Adder4:Adder1::a_xor_b Adder4:Adder1::io_cin
Adder4:Adder1::io_sum = mov T7
Adder4::s1 = cat Adder4:Adder1::io_sum Adder4:Adder0::io_sum
Adder4:Adder1::a_and_cin = and Adder4:Adder1::io_a Adder4:Adder1::io_cin
Adder4:Adder1::b_and_cin = and Adder4:Adder1::io_b Adder4:Adder1::io_cin
Adder4:Adder1::a_and_b = and Adder4:Adder1::io_a Adder4:Adder1::io_b
T8 = or Adder4:Adder1::a_and_b Adder4:Adder1::b_and_cin
T9 = or T8 Adder4:Adder1::a_and_cin
Adder4:Adder1::io_cout = mov T9
Adder4:Adder2::io_cin = mov Adder4:Adder1::io_cout
T10 = rsh/1 Adder4::io_B 2'2
Adder4:Adder2::io_b = mov T10
T11 = rsh/1 Adder4::io_A 2'2
Adder4:Adder2::io_a = mov T11
Adder4:Adder2::a_xor_b = xor Adder4:Adder2::io_a Adder4:Adder2::io_b
T12 = xor Adder4:Adder2::a_xor_b Adder4:Adder2::io_cin
Adder4:Adder2::io_sum = mov T12
Adder4::s2 = cat Adder4:Adder2::io_sum Adder4::s1
Adder4:Adder2::a_and_cin = and Adder4:Adder2::io_a Adder4:Adder2::io_cin
Adder4:Adder2::b_and_cin = and Adder4:Adder2::io_b Adder4:Adder2::io_cin
Adder4:Adder2::a_and_b = and Adder4:Adder2::io_a Adder4:Adder2::io_b
T13 = or Adder4:Adder2::a_and_b Adder4:Adder2::b_and_cin
T14 = or T13 Adder4:Adder2::a_and_cin
Adder4:Adder2::io_cout = mov T14
Adder4:Adder3::io_cin = mov Adder4:Adder2::io_cout
T15 = rsh/1 Adder4::io_B 3'2
Adder4:Adder3::io_b = mov T15
T16 = rsh/1 Adder4::io_A 3'2
Adder4:Adder3::io_a = mov T16
Adder4:Adder3::a_xor_b = xor Adder4:Adder3::io_a Adder4:Adder3::io_b
T17 = xor Adder4:Adder3::a_xor_b Adder4:Adder3::io_cin
Adder4:Adder3::io_sum = mov T17
T18 = cat Adder4:Adder3::io_sum Adder4::s2
Adder4::io_Sum = out T18
Adder4:Adder3::a_and_cin = and Adder4:Adder3::io_a Adder4:Adder3::io_cin
Adder4:Adder3::b_and_cin = and Adder4:Adder3::io_b Adder4:Adder3::io_cin
Adder4:Adder3::a_and_b = and Adder4:Adder3::io_a Adder4:Adder3::io_b
T19 = or Adder4:Adder3::a_and_b Adder4:Adder3::b_and_cin
T20 = or T19 Adder4:Adder3::a_and_cin
Adder4:Adder3::io_cout = mov T20
Adder4::io_Cout = out Adder4:Adder3::io_cout
EOF

cat >test.gold <<EOF
Adder4::io_Cin = in'1
Adder4:Adder0::io_cin = mov'1 Adder4::io_Cin
Adder4::io_B = in'4
T0 = rsh'1 Adder4::io_B 0'1
Adder4:Adder0::io_b = mov'1 T0
Adder4::io_A = in'4
T1 = rsh'1 Adder4::io_A 0'1
Adder4:Adder0::io_a = mov'1 T1
Adder4:Adder0::a_xor_b = xor'1 Adder4:Adder0::io_a Adder4:Adder0::io_b
T2 = xor'1 Adder4:Adder0::a_xor_b Adder4:Adder0::io_cin
Adder4:Adder0::io_sum = mov'1 T2
Adder4:Adder0::a_and_cin = and'1 Adder4:Adder0::io_a Adder4:Adder0::io_cin
Adder4:Adder0::b_and_cin = and'1 Adder4:Adder0::io_b Adder4:Adder0::io_cin
Adder4:Adder0::a_and_b = and'1 Adder4:Adder0::io_a Adder4:Adder0::io_b
T3 = or'1 Adder4:Adder0::a_and_b Adder4:Adder0::b_and_cin
T4 = or'1 T3 Adder4:Adder0::a_and_cin
Adder4:Adder0::io_cout = mov'1 T4
Adder4:Adder1::io_cin = mov'1 Adder4:Adder0::io_cout
T5 = rsh'1 Adder4::io_B 1'1
Adder4:Adder1::io_b = mov'1 T5
T6 = rsh'1 Adder4::io_A 1'1
Adder4:Adder1::io_a = mov'1 T6
Adder4:Adder1::a_xor_b = xor'1 Adder4:Adder1::io_a Adder4:Adder1::io_b
T7 = xor'1 Adder4:Adder1::a_xor_b Adder4:Adder1::io_cin
Adder4:Adder1::io_sum = mov'1 T7
Adder4::s1 = cat'1 Adder4:Adder1::io_sum Adder4:Adder0::io_sum
Adder4:Adder1::a_and_cin = and'1 Adder4:Adder1::io_a Adder4:Adder1::io_cin
Adder4:Adder1::b_and_cin = and'1 Adder4:Adder1::io_b Adder4:Adder1::io_cin
Adder4:Adder1::a_and_b = and'1 Adder4:Adder1::io_a Adder4:Adder1::io_b
T8 = or'1 Adder4:Adder1::a_and_b Adder4:Adder1::b_and_cin
T9 = or'1 T8 Adder4:Adder1::a_and_cin
Adder4:Adder1::io_cout = mov'1 T9
Adder4:Adder2::io_cin = mov'1 Adder4:Adder1::io_cout
T10 = rsh'1 Adder4::io_B 2'2
Adder4:Adder2::io_b = mov'1 T10
T11 = rsh'1 Adder4::io_A 2'2
Adder4:Adder2::io_a = mov'1 T11
Adder4:Adder2::a_xor_b = xor'1 Adder4:Adder2::io_a Adder4:Adder2::io_b
T12 = xor'1 Adder4:Adder2::a_xor_b Adder4:Adder2::io_cin
Adder4:Adder2::io_sum = mov'1 T12
Adder4::s2 = cat'2 Adder4:Adder2::io_sum Adder4::s1
Adder4:Adder2::a_and_cin = and'1 Adder4:Adder2::io_a Adder4:Adder2::io_cin
Adder4:Adder2::b_and_cin = and'1 Adder4:Adder2::io_b Adder4:Adder2::io_cin
Adder4:Adder2::a_and_b = and'1 Adder4:Adder2::io_a Adder4:Adder2::io_b
T13 = or'1 Adder4:Adder2::a_and_b Adder4:Adder2::b_and_cin
T14 = or'1 T13 Adder4:Adder2::a_and_cin
Adder4:Adder2::io_cout = mov'1 T14
Adder4:Adder3::io_cin = mov'1 Adder4:Adder2::io_cout
T15 = rsh'1 Adder4::io_B 3'2
Adder4:Adder3::io_b = mov'1 T15
T16 = rsh'1 Adder4::io_A 3'2
Adder4:Adder3::io_a = mov'1 T16
Adder4:Adder3::a_xor_b = xor'1 Adder4:Adder3::io_a Adder4:Adder3::io_b
T17 = xor'1 Adder4:Adder3::a_xor_b Adder4:Adder3::io_cin
Adder4:Adder3::io_sum = mov'1 T17
T18 = cat'3 Adder4:Adder3::io_sum Adder4::s2
Adder4::io_Sum = out'4 T18
Adder4:Adder3::a_and_cin = and'1 Adder4:Adder3::io_a Adder4:Adder3::io_cin
Adder4:Adder3::b_and_cin = and'1 Adder4:Adder3::io_b Adder4:Adder3::io_cin
Adder4:Adder3::a_and_b = and'1 Adder4:Adder3::io_a Adder4:Adder3::io_b
T19 = or'1 Adder4:Adder3::a_and_b Adder4:Adder3::b_and_cin
T20 = or'1 T19 Adder4:Adder3::a_and_cin
Adder4:Adder3::io_cout = mov'1 T20
Adder4::io_Cout = out'1 Adder4:Adder3::io_cout
EOF

#include "harness.bash"
